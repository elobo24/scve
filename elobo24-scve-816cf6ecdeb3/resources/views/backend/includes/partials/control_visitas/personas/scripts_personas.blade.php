<script type="text/javascript">

function justNumbers(e)
{
var keynum = window.event ? window.event.keyCode : e.which;
if ((keynum == 8) || (keynum == 46))
return true;

return /\d/.test(String.fromCharCode(keynum));
}

$(document).ready(function() {

	// Cargar imagen de la foto en forma de icono
	cargarImagen();
});

$("#cedula").change(function(event)
{
	$.get("{{url('visitantes')}}/" + event.target.value, function(response, visitantes)
	{
		if (response.nombre === undefined || response.nombre === null) {
			$('#nombre').val('');
			$('#nombre').attr("readonly", false);
		} else {
			$('#nombre').val(response.nombre);
			$('#nombre').attr("readonly", true);
		}

		if (response.apellido === undefined || response.apellido === null) {
			$('#apellido').val('');
			$('#apellido').attr("readonly", false);
		} else {
			$('#apellido').val(response.apellido);
			$('#apellido').attr("readonly", true);
		}

		if (response.sexo === undefined || response.sexo === null) {
			$('#sexo').val('');
			$('#sexo').attr("readonly", false);
		} else {
			$('#sexo').val(response.sexo);
			$('#sexo').attr("readonly", true);
		}
	});
});

$(document).ready(function() {

	$('#egresosvisitantes-table').DataTable({
		"aoColumnDefs": [{
			"bSortable": false,
			"aTargets": [6]
		}],
		"searching": true,
		"lengthChange": false,
		"lengthMenu": [[20, 40, 60], [20, 40, 60]],
		"order": [[ 0, 'asc' ]],
		"language": {
			"sProcessing":    "Procesando...",
			"sLengthMenu":    "Mostrar _MENU_ registros",
			"sZeroRecords":   "No se encontraron resultados",
			"sEmptyTable":    "Ningún dato disponible en esta tabla",
			"sInfo":          "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
			"sInfoEmpty":     "Mostrando registros del 0 al 0 de un total de 0 registros",
			"sInfoFiltered":  "(filtrado de un total de _MAX_ registros)",
			"sInfoPostFix":   "",
			"sSearch":        "Buscar:",
			"sUrl":           "",
			"sInfoThousands":  ",",
			"sLoadingRecords": "Cargando...",
			"oPaginate": {
				"sFirst":    "Primero",
				"sLast":    "Último",
				"sNext":    "Siguiente",
				"sPrevious": "Anterior"
			},
			"oAria": {
				"sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
				"sSortDescending": ": Activar para ordenar la columna de manera descendente"
			}
		}
	});
});

$( "#form-create" ).submit(function( event ) {
	event.preventDefault(event);
	swal({
		title: '¿Está seguro que quiere ingresar al visitante?',
		type: "warning",
		showCancelButton: true,
		cancelButtonText: 'Cancelar',
		confirmButtonText: 'Aceptar',
		closeOnConfirm: true
	}, function(confirmed) {
		if (confirmed) {
			$("#form-create").off("submit").submit();
		}
	});
});

$( "#form-edit" ).submit(function( event ) {
	event.preventDefault(event);
	swal({
		title: '¿Está seguro que quiere egresar al visitante?',
		type: "warning",
		showCancelButton: true,
		cancelButtonText: 'Cancelar',
		confirmButtonText: 'Aceptar',
		closeOnConfirm: true
	}, function(confirmed) {
		if (confirmed) {
			$("#form-edit").off("submit").submit();
		}
	});
});

//FUNCIÓN PARA ELIMINAR UN BANCO
var Eliminar = function(id, nombre)
{
	// ALERT JQUERY
	swal({
		title: '¿Está seguro que quiere eliminar el equipo ó bien?',
		text: ' Usted no podrá recuperar el registro ' + nombre,
		type: "warning",
		showCancelButton: true,
		cancelButtonText: 'Cancelar',
		confirmButtonText: 'Aceptar',
		closeOnConfirm: true
	}, function(confirmed) {
		if (confirmed) {
			var route = "{{url('equipos_bienes')}}/"+id+"";
			var token = $("#token").val();
			$.ajax({
				url: route,
				headers: {'X-CSRF-TOKEN': token},
				type: 'DELETE',
				dataType: 'json',
				success: function(data) {
					if (data.success == 'true')
					{
						var url='{{ url('EquiposBienes')}}';
						location.href = url;
						//Alerta de Confirmación
						swal({
							title: 'Equipo ó Bien Eliminado',
							text: "",
							type: 'success'
						});
					}
				},
				error:function(data)
				{
					switch (data.status) {
						case 400:
						$("#message-error-delete").show().html("Servidor ha entendido la solicitud, pero el contenido de solicitud no es válida.");
						break;
						case 422:
						var errors = '<ul>';
						for (datos in data.responseJSON)
						{
							errors += '<li>' +data.responseJSON[datos] + '</li>';
						}
						errors += '</ul>';
						$("#message-error-delete").show().html(errors);
						break;
						case 401:
						$("#message-error-delete").show().html("Acceso no autorizado.");
						break;
						case 403:
						$("#message-error-delete").show().html("Prohibido recurso no se puede acceder.");
						break;
						case 405:
						$("#message-error-delete").show().html("Ha ocurrido un error en la aplicación.");
						break;
						case 500:
						$("#message-error-delete").show().html("Error Interno del Servidor.");
						break;
						case 503:
						$("#message-error-delete").show().html("Servicio no disponible.");
						break;
					}
				}
			});
		}
	});
};

function cargarImagen () {
	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');
	var x = 0;
	var y = 0;
	var width = 300;
	var height = 200;
	var imageObj = new Image();

	imageObj.onload = function() {
		context.drawImage(imageObj, x, y, width, height);
	};

	imageObj.src = 'img/user.png';
}

</script>
