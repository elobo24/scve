<?php

namespace App\Http\Controllers\Backend\Reportes\Ingresos;

use Illuminate\Http\Request;

use App\Http\Requests;
use App\Http\Controllers\Controller;
use App\Models\Control_Visitas\Equipajes;
use App\Models\Control_Visitas\Visitas;
use App\Models\Control_Visitas\Visitantes;
use App\Models\Configuracion\Bienes;
use Session;
use DB;
use Illuminate\Database\Connection;
use Yajra\Datatables\Facades\Datatables;
use Jenssegers\Date\Date;

class EquiposController extends Controller
{
  public function getIndex(Request $request)
  {
    if($request->get('fecha_inicio') !='' || $request->get('fecha_fin') !='')
    {
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');
      $ReportesEquipos = Equipajes::select('t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw("(t_bienes.nombre) AS equipo"),'t_equipajes.marca','t_equipajes.modelo','t_equipajes.serial','t_equipajes.hora_entrada')
      ->join('t_visitas','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->get();
    }
    else
    {
      $fecha_inicio = '';
      $fecha_fin = '';
      $ReportesEquipos = Equipajes::select('t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw("(t_bienes.nombre) AS equipo"),'t_equipajes.marca','t_equipajes.modelo','t_equipajes.serial','t_equipajes.hora_entrada')
      ->join('t_visitas','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->get();
    }
    return view('backend.reportes.ingresos.equipos')
    ->with('fecha_inicio', $fecha_inicio)
    ->with('fecha_fin', $fecha_fin)
    ->with('ReportesEquipos', $ReportesEquipos);
  }
}
