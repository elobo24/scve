<?php

namespace App\Http\Controllers\Backend\Reportes\General;

use Illuminate\Http\Request;

use App\Http\Requests;
use App\Http\Controllers\Controller;
use App\Models\Control_Visitas\Equipajes;
use App\Models\Configuracion\Bienes;
use App\Models\Control_Visitas\Visitantes;
use App\Models\Control_Visitas\Visitas;
use App\Models\Configuracion\Empresas;
use App\Models\Configuracion\Pisos;
use App\Models\Configuracion\Oficinas;
use Session;
use DB;
use Illuminate\Database\Connection;
use Yajra\Datatables\Facades\Datatables;
use Jenssegers\Date\Date;

class EquiposController extends Controller
{
  public function getIndex(Request $request)
  {
    $selec_pisos = Pisos::select('id', 'nombre')
    ->where('estatus','ACTIVO')
    ->orderBy('nombre', 'asc')
    ->lists('nombre','id')
    ->prepend('-- SELECCIONE --', '');

    $selec_empresas = Empresas::select('id','nombre')
    ->orderBy('nombre', 'asc')
    ->lists('nombre','id')
    ->prepend('-- SELECCIONE --', '');

    if($request->get('cedula') !='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') =='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') !='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') =='' && $request->get('serial') !='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') !='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') !='' &&  $request->get('piso') =='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') !='' && $request->get('serial') !='' && $request->get('fecha_inicio') =='' && $request->get('fecha_fin') =='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') !='' &&  $request->get('piso') !='' && $request->get('serial') =='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') =='' && $request->get('empresa') =='' &&  $request->get('piso') !='' && $request->get('serial') !='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    elseif($request->get('cedula') !='' && $request->get('empresa') !='' &&  $request->get('piso') !='' && $request->get('serial') !='' && $request->get('fecha_inicio') !='' && $request->get('fecha_fin') !='')
    {
      $cedula = $request->get('cedula');
      $empresa = $request->get('empresa');
      $piso = $request->get('piso');
      $serial = $request->get('serial');
      $fecha_inicio = $request->get('fecha_inicio');
      $fecha_fin = $request->get('fecha_fin');

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_visitantes.cedula','=',$cedula)
      ->where('t_empresas.id','=',$empresa)
      ->where('t_pisos.id','=',$piso)
      ->where('t_equipajes.serial','=',$serial)
      ->whereBetween(DB::raw('t_equipajes.hora_entrada::date'), [$fecha_inicio, $fecha_fin])
      ->first();
    }
    else
    {
      $cedula = '';
      $empresa = '';
      $piso = '';
      $serial = '';
      $fecha_inicio = '';
      $fecha_fin = '';

      $ReportesGeneralEquipos = empresas::select(DB::raw('(t_empresas.nombre)AS empresas'),DB::raw('(t_pisos.nombre)AS pisos'),'t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido',DB::raw('(t_bienes.nombre)AS equipo'),'t_equipajes.serial','t_equipajes.hora_entrada','t_equipajes.hora_salida')
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->orderBy('t_empresas.nombre', 'ASC')
      ->get();

      $TotalEmpresas = empresas::select(DB::raw('COUNT(t_empresas.nombre) as total'))
      ->join('t_visitas','t_visitas.empresa_id','=','t_empresas.id')
      ->join('t_visitantes','t_visitas.visitante_id','=','t_visitantes.id')
      ->join('t_oficinas','t_empresas.oficina_id','=','t_oficinas.id')
      ->join('t_pisos','t_oficinas.piso_id','=','t_pisos.id')
      ->join('t_equipajes','t_equipajes.visita_id','=','t_visitas.id')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where(DB::raw('current_date'),'=',DB::raw('t_equipajes.hora_entrada::date'))
      ->first();
    }
    return view('backend.reportes.general.equipos')
    ->with('selec_empresas', $selec_empresas)
    ->with('selec_pisos', $selec_pisos)
    ->with('cedula', $cedula)
    ->with('empresa', $empresa)
    ->with('piso', $piso)
    ->with('serial', $serial)
    ->with('fecha_inicio', $fecha_inicio)
    ->with('fecha_fin', $fecha_fin)
    ->with('ReportesGeneralEquipos', $ReportesGeneralEquipos)
    ->with('TotalEmpresas', $TotalEmpresas);
  }
}
