<?php

namespace App\Http\Controllers\Backend;

use App\Http\Controllers\Controller;
use App\Models\Configuracion\Empresas;
use App\Models\Control_Visitas\Visitantes;
use App\Models\Control_Visitas\Visitas;
use App\Models\Configuracion\Bienes;
use App\Models\Control_Visitas\Equipajes;
use Session;
use DB;
use Illuminate\Database\Connection;
use Yajra\Datatables\Facades\Datatables;
use Jenssegers\Date\Date;
use Input;

/**
 * Class DashboardController
 * @package App\Http\Controllers\Backend
 */
class DashboardController extends Controller
{
    /**
     * @return \Illuminate\View\View
     */
    public function index()
    {
      $query = "SELECT * FROM sp_dashboard_ingresos_personas()";
      $IngresosPersonas = DB::select($query);

      $query = "SELECT * FROM sp_dashboard_egresos_personas()";
      $EgresosPersonas = DB::select($query);

      return view('backend.dashboard')
      ->with('IngresosPersonas', $IngresosPersonas)
      ->with('EgresosPersonas', $EgresosPersonas);
    }
    public function show($id)
    {
      $IngresosPersonas = Visitantes::select('t_visitantes.cedula','t_visitantes.nombre','t_visitantes.apellido','t_visitantes.foto','t_visitas.empresa_origen',DB::raw("(t_empresas.nombre) AS empresa_destino"),'t_visitas.entrada')
      ->Join('t_visitas','t_visitas.visitante_id','=','t_visitantes.id')
      ->Join('t_empresas','t_visitas.empresa_id','=','t_empresas.id')
      ->where('t_visitas.id','=', $id)
      ->get()
      ->first();

      $IngresosEquipos = Equipajes::select('t_equipajes.marca','t_equipajes.serial','t_equipajes.descripcion','t_equipajes.hora_entrada','t_bienes.nombre')
      ->join('t_bienes','t_equipajes.bien_id','=','t_bienes.id')
      ->where('t_equipajes.visita_id','=', $id)
      ->get();

      return view('backend.dashboard.ingresos.personas.show')
      ->with('IngresosPersonas',$IngresosPersonas)
      ->with('IngresosEquipos', $IngresosEquipos);
    }
    public function foto($id)
    {
      $IngresosPersonas = Visitas::select('t_visitas.foto')
      ->where('t_visitas.id','=',$id)
      ->get()
      ->first();

      return view('backend.dashboard')
      ->with('IngresosPersonas',$IngresosPersonas);
    }
}
