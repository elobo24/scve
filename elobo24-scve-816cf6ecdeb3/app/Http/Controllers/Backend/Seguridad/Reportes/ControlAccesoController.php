<?php

namespace App\Http\Controllers\Backend\Seguridad\Reportes;

use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;
use Session;
use DB;

class ControlAccesoController extends Controller
{
    public function getIndex()
    {
        $logs = DB::table('audits')
        ->where('url', 'LIKE', '%login')
        ->orWhere('url', 'LIKE', '%logout')
        ->leftJoin('users', 'users.id', '=', 'audits.user_id')
        ->orderBy('audits.id', 'DESC')
        ->select('audits.*', 'users.name as username', 'users.email as user_email')
        ->paginate(10);

        for($x = 0; $x < count($logs); $x++) {

            $logs[$x]->action = strpos($logs[$x]->url, 'login') ? 'Inicio de sesión' : 'Cierre de sesión';
        }


        return view('backend.seguridad.reportes.control_acceso.index')
        ->with('logs', $logs);
    }

}
