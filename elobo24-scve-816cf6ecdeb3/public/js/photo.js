(function() {

  var video = document.getElementById('video'),
  canvas = document.getElementById('canvas'),
  context = canvas.getContext('2d'),
  photo =  document.getElementById('photo'),
  foto =  document.getElementById('foto'),
  vendorUrl = window.URL || window.webkitURL;

  navigator.getMedia = navigator.getUserMedia ||
  navigator.webKitGetUserMedia ||
  navigator.msGetUserMedia;

  if (navigator.mediaDevices.getUserMedia) {
    var p = navigator.mediaDevices.getUserMedia({  audio: false, video: true });
    p.then(function (stream) {
      video.srcObject = stream;
      video.play();
    })
    p.catch(function (e) {
      console.log(e.name + ": " + e.message);
    });
  }
  else {
    navigator.getMedia({
      video :true,
      audio : false
    }, function(stream) {
      video.src = vendorUrl.createObjectURL(stream);
      video.play();
    }, function(e) {
      console.log(e.name + ": " + e.message);
    });
  }

  document.getElementById('capture').addEventListener('click', function() {
    context.drawImage(video, 0, 0, 300, 200);
    foto.setAttribute('value', canvas.toDataURL('image/png'));
  });
})();
